# Household MCP Server

å®¶è¨ˆç°¿CSVã‚’ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã§åˆ†æã—ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®è‡ªç„¶è¨€èªä¼šè©±ã«å¿…è¦ãªæƒ…å ±ã‚’æä¾›ã™ã‚‹ MCPï¼ˆModel Context Protocolï¼‰ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®å®¶è¨ˆç°¿CSVï¼ˆ`data/` é…ä¸‹ï¼‰ã‚’ pandas ã§åˆ†æã—ã€AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®è‡ªç„¶è¨€èªãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œç­”ã™ã‚‹ MCP ã‚µãƒ¼ãƒãƒ¼ã‚’æä¾›ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡é›‘ãªã‚¯ã‚¨ãƒªè¨€èªã‚’å­¦ã¶ã“ã¨ãªãã€æ—¥å¸¸ä¼šè©±ã§å®¶è¨ˆãƒ‡ãƒ¼ã‚¿ã®æ´å¯Ÿã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

- **è‡ªç„¶è¨€èªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: æ—¥æœ¬èªã§ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»æœŸé–“åˆ¥ã®æ”¯å‡ºæ¨ç§»ã‚’ç¢ºèª
- **ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ**: æœˆæ¬¡é›†è¨ˆã€å‰æœˆæ¯”ãƒ»å‰å¹´åŒæœˆæ¯”ãƒ»12ã‹æœˆç§»å‹•å¹³å‡ã®è¨ˆç®—
- **ã‚«ãƒ†ã‚´ãƒªãƒã‚¤ãƒ©ã‚¤ãƒˆ**: æŒ‡å®šæœŸé–“ã§æ”¯å‡ºãŒå¤§ãã„ã‚«ãƒ†ã‚´ãƒªã‚’è‡ªå‹•æŠ½å‡º
- **ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµè¨­è¨ˆ**: CSV ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§èª­ã¿è¾¼ã¿ã€å¤–éƒ¨é€šä¿¡ãªã—ã§è§£æ

## è¦ä»¶

- Python 3.12 ä»¥ä¸Šï¼ˆ`uv` ã‚’æ¨å¥¨ï¼‰
- å®¶è¨ˆç°¿ CSV ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`data/åå…¥ãƒ»æ”¯å‡ºè©³ç´°_YYYY-MM-DD_YYYY-MM-DD.csv` å½¢å¼ï¼‰

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### åŸºæœ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# æ¨å¥¨: uv ã‚’ç”¨ã„ãŸåŸºæœ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆMCP ã‚µãƒ¼ãƒãƒ¼ã®ã¿ï¼‰
uv pip install -e "."

# ä»£æ›¿: pip ã‚’ä½¿ç”¨
pip install -e "."

# é–‹ç™ºç’°å¢ƒï¼ˆãƒ†ã‚¹ãƒˆãƒ»lintå«ã‚€ï¼‰
uv pip install -e ".[dev]"
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®è¿½åŠ 

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ä¾å­˜é–¢ä¿‚ã®è»½é‡åŒ–ã®ãŸã‚ã€è¿½åŠ æ©Ÿèƒ½ã¯ **optional dependencies** ã¨ã—ã¦æä¾›ã•ã‚Œã¾ã™ã€‚
å¿…è¦ãªæ©Ÿèƒ½ã«å¿œã˜ã¦ã€ä»¥ä¸‹ã‹ã‚‰é¸æŠã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

#### æ©Ÿèƒ½åˆ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰

| æ©Ÿèƒ½ | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | ç”¨é€” | ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ•° |
|------|---------|------|---|
| **MCP ã‚µãƒ¼ãƒãƒ¼åŸºæœ¬** | ãªã— | CSV èª­ã¿è¾¼ã¿ãƒ»MCP ãƒªã‚½ãƒ¼ã‚¹/ãƒ„ãƒ¼ãƒ«æä¾› | 4 å€‹ |
| **ç”»åƒç”Ÿæˆ** | `visualization` | ã‚°ãƒ©ãƒ•ãƒ»ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆï¼ˆPNG/SVGï¼‰ | +3 å€‹ |
| **HTTP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°** | `streaming` | FastAPI çµŒç”±ã®ç”»åƒé…ä¿¡ | +3 å€‹ |
| **Web API** | `web` | REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | +4 å€‹ |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº** | `db` | SQLite/PostgreSQL ã¸ã®æ°¸ç¶šåŒ– | +2 å€‹ |
| **èªè¨¼** | `auth` | JWTãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼æ©Ÿèƒ½ | +2 å€‹ |
| **éåŒæœŸ I/O** | `io` | aiofilesãƒ»httpx å¯¾å¿œ | +2 å€‹ |
| **æ§‹é€ åŒ–ãƒ­ã‚°** | `logging` | structlog ã«ã‚ˆã‚‹è©³ç´°ãƒ­ã‚°å‡ºåŠ› | +1 å€‹ |
| **ã™ã¹ã¦** | `full` | å…¨æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ– | +17 å€‹ |

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¾‹

```bash
# â‘  ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã®ã¿è¿½åŠ ï¼ˆã‚°ãƒ©ãƒ•ç”Ÿæˆç”¨ï¼‰
uv pip install -e ".[visualization]"

# â‘¡ HTTP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œï¼ˆFastAPI + uvicorn + ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
uv pip install -e ".[streaming]"

# â‘¢ Web APIï¼ˆREST ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæä¾›ï¼‰
uv pip install -e ".[web]"

# â‘£ è¤‡åˆ: ç”»åƒç”Ÿæˆ + HTTP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
uv pip install -e ".[visualization,streaming]"

# â‘¤ é–‹ç™ºç’°å¢ƒ + ç”»åƒç”Ÿæˆæ©Ÿèƒ½
uv pip install -e ".[dev,visualization]"

# â‘¥ é–‹ç™ºç’°å¢ƒ + ã™ã¹ã¦ã®æ©Ÿèƒ½ï¼ˆæ¨å¥¨ for developmentï¼‰
uv pip install -e ".[dev,full]"

# â‘¦ æœ¬ç•ªç’°å¢ƒ: Web API + ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° + ãƒ­ã‚°
uv pip install -e ".[web,streaming,logging]"

# â‘§ å®Œå…¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã™ã¹ã¦ã®æ©Ÿèƒ½ï¼‰
uv pip install -e ".[full]"
```

### å„ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®è©³ç´°

#### ğŸ¨ `visualization` - ç”»åƒç”Ÿæˆæ©Ÿèƒ½

æ”¯å‡ºãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ã‚°ãƒ©ãƒ•ã¨ã—ã¦ PNG/SVG å½¢å¼ã§ç”Ÿæˆã—ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `matplotlib >= 3.8.0` - ã‚°ãƒ©ãƒ•æç”»
- `plotly >= 5.17.0` - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ¼ãƒˆ
- `pillow >= 10.0.0` - ç”»åƒå‡¦ç†

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[visualization]"
python -c "from src.household_mcp.visualization import ChartGenerator; print('OK')"
```

**å¿…è¦ãªè¨­å®š:**

- æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆé…ç½®ï¼ˆ`fonts/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« Noto Sans CJK ã‚’é…ç½®ï¼‰
- è©³ç´°ã¯ä¸‹è¨˜ã€Œæ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã€ã‚’å‚ç…§

---

#### ğŸŒ `streaming` - HTTP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ

ç”»åƒã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç›´æ¥é…ä¿¡å¯èƒ½ãª HTTP ã‚µãƒ¼ãƒãƒ¼æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `fastapi >= 0.100.0` - Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- `uvicorn[standard] >= 0.23.0` - ASGI ã‚µãƒ¼ãƒãƒ¼
- `cachetools >= 5.3.0` - ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æ©Ÿæ§‹

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[streaming]"
python -m src.server --transport http --port 8080
```

**ä¾å­˜é–¢ä¿‚:**

- `visualization` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚°ãƒ©ãƒ•ã‚’ HTTP çµŒç”±ã§é…ä¿¡å¯èƒ½

---

#### ğŸ”Œ `web` - REST API

å®Œå…¨ãª REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…¬é–‹ã—ã€HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `fastapi >= 0.100.0`
- `uvicorn[standard] >= 0.23.0`
- `pydantic >= 2.11, < 3` - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼
- `python-multipart >= 0.0.6` - ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒˆå½¢å¼å¯¾å¿œ

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[web]"
uv run uvicorn src.household_mcp.server:app --port 8000
```

---

#### ğŸ’¾ `db` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº

SQLAlchemy ORM ã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ°¸ç¶šåŒ–ï¼ˆå°†æ¥ã®æ‹¡å¼µå‘ã‘ï¼‰

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `sqlalchemy >= 2.0.23` - ORM
- `alembic >= 1.12.1` - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[db]"
# SQLite/PostgreSQL ã¸ã®æ°¸ç¶šåŒ–æ©Ÿèƒ½ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
```

---

#### ğŸ” `auth` - èªè¨¼æ©Ÿèƒ½

JWTãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚’å®Ÿè£…ã—ã€API ã®ä¿è­·ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã«å¯¾å¿œã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `passlib[bcrypt] >= 1.7.4` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ³ã‚°
- `python-jose[cryptography] >= 3.3.0` - JWT ç½²å

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[auth]"
# API èªè¨¼æ©Ÿèƒ½ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
```

---

#### âš¡ `io` - éåŒæœŸ I/O

éåŒæœŸãƒ•ã‚¡ã‚¤ãƒ« I/Oãƒ»HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ©Ÿèƒ½ã‚’æä¾›ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `aiofiles >= 23.2.1` - éåŒæœŸãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
- `httpx >= 0.25.2` - éåŒæœŸ HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

---

#### ğŸ“Š `logging` - æ§‹é€ åŒ–ãƒ­ã‚°

JSON å½¢å¼ã®æ§‹é€ åŒ–ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã€ãƒ­ã‚°è§£æãƒ»ç›£è¦–ã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `structlog >= 23.2.0` - ãƒ­ã‚°æ§‹é€ åŒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[logging]"
# ç’°å¢ƒå¤‰æ•°ã§æœ‰åŠ¹åŒ–: HOUSEHOLD_MCP_LOGGING=structlog
```

---

#### ğŸ `full` - å®Œå…¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã™ã¹ã¦ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚é–‹ç™ºç’°å¢ƒã‚„è©¦é¨“ç”¨ã«æ¨å¥¨ã€‚

```bash
uv pip install -e ".[full]"
uv pip install -e ".[full,dev]"  # é–‹ç™ºç’°å¢ƒ + å…¨æ©Ÿèƒ½
```

### Poetry ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```bash
poetry install --with dev
# ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½: poetry install -E visualization
```

### pre-commit ãƒ•ãƒƒã‚¯ã®æœ‰åŠ¹åŒ–

```bash
pre-commit install
```

## ä½¿ç”¨æ–¹æ³•

### MCP ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•

```bash
# æ¨™æº– MCP ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆstdio ãƒ¢ãƒ¼ãƒ‰ï¼‰
python -m src.server

# HTTPã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆç”»åƒé…ä¿¡å¯¾å¿œï¼‰
# æ³¨: streaming ã¾ãŸã¯ web extras ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦
uv pip install -e ".[streaming]"
python -m src.server --transport streamable-http --port 8000

# ã¾ãŸã¯ uvicorn ã§ç›´æ¥èµ·å‹•
uv run uvicorn household_mcp.http_server:app --host 0.0.0.0 --port 8000
```

### ç”»åƒç”Ÿæˆæ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€è¿½åŠ ã®ä¾å­˜é–¢ä¿‚ã¨ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šãŒå¿…è¦ã§ã™ï¼š

```bash
# ç”»åƒç”Ÿæˆã«å¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv pip install -e ".[visualization]"

# æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã‚’é…ç½®
# fonts/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« Noto Sans CJK ã‚’é…ç½®
# è©³ç´°ã¯ã€Œæ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§
```

**ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒ—**:

- å††ã‚°ãƒ©ãƒ•ï¼ˆpieï¼‰: ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡ºå‰²åˆ
- æ£’ã‚°ãƒ©ãƒ•ï¼ˆbarï¼‰: ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¯”è¼ƒ
- æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼ˆlineï¼‰: æ™‚ç³»åˆ—ãƒˆãƒ¬ãƒ³ãƒ‰
- é¢ã‚°ãƒ©ãƒ•ï¼ˆareaï¼‰: ç´¯ç©ãƒˆãƒ¬ãƒ³ãƒ‰

**MCP ãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã®ä½¿ç”¨ä¾‹**:

```python
# æœˆæ¬¡ã‚µãƒãƒªãƒ¼ã‚’ç”»åƒã§å–å¾—
{
  "tool": "get_monthly_household",
  "arguments": {
    "year": 2025,
    "month": 10,
    "output_format": "image",
    "graph_type": "pie",
    "image_size": "800x600",
    "image_format": "png"
  }
}

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "success": true,
  "type": "image",
  "url": "http://localhost:8000/api/charts/abc123...",
  "metadata": {
    "graph_type": "pie",
    "format": "png",
    "size": "800x600",
    "cache_key": "abc123..."
  }
}

# ã‚«ãƒ†ã‚´ãƒªãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ç”»åƒã§å–å¾—
{
  "tool": "get_category_trend",
  "arguments": {
    "category": "é£Ÿè²»",
    "start_month": "2024-01",
    "end_month": "2024-06",
    "output_format": "image"
  }
}
```

**HTTP ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹**:

HTTPã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã—ãŸå ´åˆã€ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼š

```bash
# ç”»åƒå–å¾—ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é…ä¿¡ï¼‰
GET http://localhost:8000/api/charts/{chart_id}

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥æƒ…å ±å–å¾—
GET http://localhost:8000/api/charts/{chart_id}/info

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±è¨ˆ
GET http://localhost:8000/api/cache/stats

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
DELETE http://localhost:8000/api/cache

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
GET http://localhost:8000/health
```

è©³ç´°ã¯ `docs/api.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### åˆ©ç”¨å¯èƒ½ãª MCP ãƒªã‚½ãƒ¼ã‚¹ / ãƒ„ãƒ¼ãƒ«

| åç§°                            | ç¨®åˆ¥     | èª¬æ˜                                       |
| ------------------------------- | -------- | ------------------------------------------ |
| `data://category_hierarchy`     | Resource | å¤§é …ç›®â†’ä¸­é …ç›®ã®ã‚«ãƒ†ã‚´ãƒªè¾æ›¸                |
| `data://available_months`       | Resource | CSV ã‹ã‚‰æ¤œå‡ºã—ãŸåˆ©ç”¨å¯èƒ½å¹´æœˆ               |
| `data://category_trend_summary` | Resource | ç›´è¿‘ 12 ã‹æœˆã®ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒˆãƒ¬ãƒ³ãƒ‰æƒ…å ±       |
| `get_monthly_household`         | Tool     | æŒ‡å®šå¹´æœˆã®æ”¯å‡ºæ˜ç´°ä¸€è¦§                     |
| `get_category_trend`            | Tool     | æŒ‡å®šã‚«ãƒ†ã‚´ãƒª or ä¸Šä½ã‚«ãƒ†ã‚´ãƒªã®ãƒˆãƒ¬ãƒ³ãƒ‰è§£èª¬ |
| `category_analysis`             | Tool     | ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®æœŸé–“åˆ†æï¼ˆå‰æœˆæ¯”ãƒ»æœ€å¤§æœ€å°ï¼‰    |
| `find_categories`               | Tool     | åˆ©ç”¨å¯èƒ½ãªã‚«ãƒ†ã‚´ãƒªä¸€è¦§ã‚’å–å¾—               |
| `monthly_summary`               | Tool     | æœˆæ¬¡ã‚µãƒãƒªï¼ˆåå…¥ãƒ»æ”¯å‡ºãƒ»ã‚«ãƒ†ã‚´ãƒªåˆ¥é›†è¨ˆï¼‰    |

### ãƒ†ã‚¹ãƒˆãƒ»ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
uv run pytest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
uv run pytest --cov=src/household_mcp --cov-report=html

# ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
uv run black .          # ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
uv run isort .          # ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ•´ç†
uv run flake8           # ãƒªãƒ³ãƒˆ
uv run mypy src/        # å‹ãƒã‚§ãƒƒã‚¯
uv run bandit -r src/   # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³

# ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ã‚’ä¸€æ‹¬å®Ÿè¡Œ
uv run task all-checks  # â€» tasks.json ã«å®šç¾©
```

### ã‚µãƒ³ãƒ—ãƒ«å¿œç­”

```json
{
  "category": "é£Ÿè²»",
  "start_month": "2025-06",
  "end_month": "2025-07",
  "text": "é£Ÿè²»ã® 2025å¹´06æœˆã€œ2025å¹´07æœˆ ã®æ¨ç§»ã§ã™ã€‚...",
  "metrics": [
    {"month": "2025-06", "amount": -62500, "month_over_month": null},
    {"month": "2025-07", "amount": -58300, "month_over_month": -0.067}
  ]
}
```

### ãƒ†ã‚¹ãƒˆ

```bash
uv run pytest
```

ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ 80% ã‚’æº€ãŸã™ã¨æˆåŠŸã§ã™ã€‚

## æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®š

ã‚°ãƒ©ãƒ•ç”Ÿæˆæ©Ÿèƒ½ã§æ—¥æœ¬èªï¼ˆæ¼¢å­—ãƒ»ã‚«ãƒŠï¼‰ã‚’æ­£ã—ãæç”»ã™ã‚‹ã«ã¯ã€æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚

### ãƒ•ã‚©ãƒ³ãƒˆé…ç½®ï¼ˆæ¨å¥¨ï¼‰

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `fonts/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« Noto Sans CJK ãƒ•ã‚©ãƒ³ãƒˆã‚’é…ç½®ã—ã¾ã™ï¼š

```bash
# Debian/Ubuntu ã®å ´åˆ
sudo apt-get install fonts-noto-cjk
cp /usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc fonts/

# ã¾ãŸã¯ã€ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
wget https://github.com/googlefonts/noto-cjk/raw/main/Sans/OTF/Japanese/NotoSansCJKjp-Regular.otf -O fonts/NotoSansCJKjp-Regular.otf
```

è©³ç´°ãªæ‰‹é †ã¯ `fonts/README.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ•ã‚©ãƒ³ãƒˆæ¤œå‡ºã®å„ªå…ˆé †ä½

`ChartGenerator` ã¯ä»¥ä¸‹ã®é †åºã§ãƒ•ã‚©ãƒ³ãƒˆã‚’æ¤œå‡ºã—ã¾ã™ï¼š

1. **ãƒ­ãƒ¼ã‚«ãƒ« fonts/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã® `fonts/` é…ä¸‹
2. **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ãƒ‘ã‚¹**:
   - Linux: `/usr/share/fonts/opentype/noto/`, `/usr/share/fonts/truetype/noto/`
   - macOS: `/System/Library/Fonts/`
   - Windows: `C:/Windows/Fonts/`
3. **matplotlib font_manager**: ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå…¨ãƒ•ã‚©ãƒ³ãƒˆã‹ã‚‰æ¤œç´¢

### ãƒ•ã‚©ãƒ³ãƒˆæœªè¨­å®šæ™‚ã®å‹•ä½œ

ãƒ•ã‚©ãƒ³ãƒˆãŒæ¤œå‡ºã§ããªã„å ´åˆã§ã‚‚ã‚°ãƒ©ãƒ•ç”Ÿæˆã¯å¯èƒ½ã§ã™ãŒã€æ—¥æœ¬èªãŒæ–‡å­—åŒ–ã‘ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€å¿…ãšæ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚

### ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå‚è€ƒï¼‰

```bash
# Debian/Ubuntu
sudo apt-get update && sudo apt-get install -y fonts-noto-cjk

# Arch Linux
sudo pacman -Sy --noconfirm noto-fonts-cjk

# Alpine Linux
sudo apk add --no-cache font-noto-cjk

# macOS (Homebrew)
brew install font-noto-sans-cjk-jp

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ãƒ•ã‚©ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
fc-cache -fv
```

## é–‹ç™º

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [Kiro's Spec-Driven Development](https://github.com/kiro-dev) ã«å¾“ã£ã¦é–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ï¼š

- [`requirements.md`](requirements.md) - è¦ä»¶å®šç¾©
- [`design.md`](design.md) - æŠ€è¡“è¨­è¨ˆ
- [`tasks.md`](tasks.md) - å®Ÿè£…ã‚¿ã‚¹ã‚¯

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
