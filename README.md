# Household MCP Server

[![CI](https://github.com/raoshun/my_household_mcpserver/actions/workflows/ci.yml/badge.svg)](https://github.com/raoshun/my_household_mcpserver/actions/workflows/ci.yml)
[![codecov](https://codecov.io/gh/raoshun/my_household_mcpserver/branch/main/graph/badge.svg)](https://codecov.io/gh/raoshun/my_household_mcpserver)
[![Python 3.11-3.14](https://img.shields.io/badge/python-3.11%20%7C%203.12%20%7C%203.13%20%7C%203.14-blue.svg)](https://www.python.org/downloads/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)

å®¶è¨ˆç°¿CSVã‚’ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã§åˆ†æã—ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®è‡ªç„¶è¨€èªä¼šè©±ã«å¿…è¦ãªæƒ…å ±ã‚’æä¾›ã™ã‚‹ MCPï¼ˆModel Context Protocolï¼‰ã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚

## æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã®å®¶è¨ˆç°¿CSVï¼ˆ`data/` é…ä¸‹ï¼‰ã‚’ pandas ã§åˆ†æã—ã€AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‹ã‚‰ã®è‡ªç„¶è¨€èªãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¿œç­”ã™ã‚‹ MCP ã‚µãƒ¼ãƒãƒ¼ã‚’æä¾›ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è¤‡é›‘ãªã‚¯ã‚¨ãƒªè¨€èªã‚’å­¦ã¶ã“ã¨ãªãã€æ—¥å¸¸ä¼šè©±ã§å®¶è¨ˆãƒ‡ãƒ¼ã‚¿ã®æ´å¯Ÿã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

### ãƒªãƒã‚¸ãƒˆãƒªæ§‹æˆï¼ˆMonorepoï¼‰

ãƒªãƒã‚¸ãƒˆãƒªã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«åˆ†å‰²ã•ã‚Œã¦ã„ã¾ã™ï¼ˆFR-020ï¼‰ã€‚

- `backend/`: Python è£½ã® MCP/HTTP API ã‚µãƒ¼ãƒãƒ¼ï¼ˆãƒ†ã‚¹ãƒˆã¯ `backend/tests/`ï¼‰
- `frontend/`: é™çš„ Web ã‚¢ãƒ—ãƒªï¼ˆVanilla JS + Chart.jsï¼‰ã€‚ãƒ­ãƒ¼ã‚«ãƒ«HTTPã‚µãƒ¼ãƒã§é…ä¿¡ã€‚

VS Code ã®ã‚¿ã‚¹ã‚¯ï¼ˆ.vscode/tasks.jsonï¼‰ãŒãƒ¢ãƒãƒ¬ãƒæ§‹æˆã«å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®é–‹ç™º: ã€ŒInstall Dependenciesã€ã€ŒRun Testsã€ã€ŒStart HTTP API Serverã€
- è¿½åŠ ä¾å­˜ã®å°å…¥: ã€ŒInstall Web/Streaming Extrasã€ï¼ˆFastAPI/uvicorn/SQLAlchemyãªã©ï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®èµ·å‹•: ã€ŒStart Webapp HTTP Serverã€
- ã¾ã¨ã‚å®Ÿè¡Œ: ã€ŒStart Full Webapp Stackã€ï¼ˆAPI 8000 + Web 8080ï¼‰

## ä¸»ãªæ©Ÿèƒ½

- **è‡ªç„¶è¨€èªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹**: æ—¥æœ¬èªã§ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ»æœŸé–“åˆ¥ã®æ”¯å‡ºæ¨ç§»ã‚’ç¢ºèª
- **ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ**: æœˆæ¬¡é›†è¨ˆã€å‰æœˆæ¯”ãƒ»å‰å¹´åŒæœˆæ¯”ãƒ»12ã‹æœˆç§»å‹•å¹³å‡ã®è¨ˆç®—
- **ã‚«ãƒ†ã‚´ãƒªãƒã‚¤ãƒ©ã‚¤ãƒˆ**: æŒ‡å®šæœŸé–“ã§æ”¯å‡ºãŒå¤§ãã„ã‚«ãƒ†ã‚´ãƒªã‚’è‡ªå‹•æŠ½å‡º
- **é‡è¤‡ãƒ¬ã‚³ãƒ¼ãƒ‰æ¤œå‡º**: AIã¨ã®ä¼šè©±ã§é‡è¤‡å–å¼•ã‚’æ¤œå‡ºãƒ»è§£æ¶ˆï¼ˆ[è©³ç´°](docs/duplicate_detection.md)ï¼‰
- **ãƒ­ãƒ¼ã‚«ãƒ«å®Œçµè¨­è¨ˆ**: CSV ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§èª­ã¿è¾¼ã¿ã€å¤–éƒ¨é€šä¿¡ãªã—ã§è§£æ

## è¦ä»¶

- Python 3.12 ä»¥ä¸Šï¼ˆ`uv` ã‚’æ¨å¥¨ï¼‰
- å®¶è¨ˆç°¿ CSV ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`data/åå…¥ãƒ»æ”¯å‡ºè©³ç´°_YYYY-MM-DD_YYYY-MM-DD.csv` å½¢å¼ï¼‰

## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

### ä¾å­˜æœ€å°åŒ–ãƒãƒªã‚·ãƒ¼

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ **ä¾å­˜é–¢ä¿‚ã®æœ€å°åŒ–** ã‚’é‡è¦–ã—ã¦ã„ã¾ã™ï¼š

- **ã‚³ã‚¢æ©Ÿèƒ½**: å¿…é ˆä¾å­˜ã¯4ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã¿ï¼ˆpandas, numpy, mcp, fastmcpï¼‰
- **ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½**: è¿½åŠ æ©Ÿèƒ½ã¯optional dependenciesã¨ã—ã¦åˆ†é›¢
- **ç›®çš„**: ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚µã‚¤ã‚ºã®å‰Šæ¸›ã€ä¾å­˜é–¢ä¿‚ã®è¡çªå›é¿ã€è»½é‡ãªå®Ÿè¡Œç’°å¢ƒ

**è¨­è¨ˆåŸå‰‡:**

1. MCP ã‚µãƒ¼ãƒãƒ¼ã¨ã—ã¦ã®åŸºæœ¬æ©Ÿèƒ½ï¼ˆCSVèª­ã¿è¾¼ã¿ã€ãƒ‡ãƒ¼ã‚¿åˆ†æã€ãƒªã‚½ãƒ¼ã‚¹/ãƒ„ãƒ¼ãƒ«æä¾›ï¼‰ã¯æœ€å°ä¾å­˜ã§å‹•ä½œ
2. ç”»åƒç”Ÿæˆã€Web APIã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æºãªã©ã®æ‹¡å¼µæ©Ÿèƒ½ã¯å¿…è¦ã«å¿œã˜ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. å„æ©Ÿèƒ½ã‚°ãƒ«ãƒ¼ãƒ—ã¯ç‹¬ç«‹ã—ã¦ãŠã‚Šã€å¿…è¦ãªã‚‚ã®ã ã‘ã‚’é¸æŠå¯èƒ½

### åŸºæœ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# æ¨å¥¨: uv ã‚’ç”¨ã„ãŸåŸºæœ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆMCP ã‚µãƒ¼ãƒãƒ¼ã®ã¿ï¼‰
uv pip install -e "."

# ä»£æ›¿: pip ã‚’ä½¿ç”¨
pip install -e "."

# é–‹ç™ºç’°å¢ƒï¼ˆãƒ†ã‚¹ãƒˆãƒ»lintå«ã‚€ï¼‰
uv pip install -e ".[dev]"
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®è¿½åŠ 

å¿…è¦ãªæ©Ÿèƒ½ã«å¿œã˜ã¦ã€ä»¥ä¸‹ã‹ã‚‰é¸æŠã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

#### æ©Ÿèƒ½åˆ¥ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¬ã‚¤ãƒ‰

| æ©Ÿèƒ½                    | ã‚ªãƒ—ã‚·ãƒ§ãƒ³      | ç”¨é€”                                  | ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ•° |
| ----------------------- | --------------- | ------------------------------------- | ---------------- |
| **MCP ã‚µãƒ¼ãƒãƒ¼åŸºæœ¬**    | ãªã—            | CSV èª­ã¿è¾¼ã¿ãƒ»MCP ãƒªã‚½ãƒ¼ã‚¹/ãƒ„ãƒ¼ãƒ«æä¾› | 4 å€‹             |
| **ç”»åƒç”Ÿæˆ**            | `visualization` | ã‚°ãƒ©ãƒ•ãƒ»ãƒãƒ£ãƒ¼ãƒˆç”Ÿæˆï¼ˆPNG/SVGï¼‰       | +3 å€‹            |
| **HTTP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°** | `streaming`     | FastAPI çµŒç”±ã®ç”»åƒé…ä¿¡                | +3 å€‹            |
| **Web API**             | `web`           | REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ               | +4 å€‹            |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº**    | `db`            | SQLite/PostgreSQL ã¸ã®æ°¸ç¶šåŒ–          | +2 å€‹            |
| **èªè¨¼**                | `auth`          | JWTãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼æ©Ÿèƒ½               | +2 å€‹            |
| **éåŒæœŸ I/O**          | `io`            | aiofilesãƒ»httpx å¯¾å¿œ                  | +2 å€‹            |
| **æ§‹é€ åŒ–ãƒ­ã‚°**          | `logging`       | structlog ã«ã‚ˆã‚‹è©³ç´°ãƒ­ã‚°å‡ºåŠ›          | +1 å€‹            |
| **ã™ã¹ã¦**              | `full`          | å…¨æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–                        | +17 å€‹           |

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¾‹

```bash
# â‘  ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã®ã¿è¿½åŠ ï¼ˆã‚°ãƒ©ãƒ•ç”Ÿæˆç”¨ï¼‰
uv pip install -e ".[visualization]"

# â‘¡ HTTP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œï¼ˆFastAPI + uvicorn + ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
uv pip install -e ".[streaming]"

# â‘¢ Web APIï¼ˆREST ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæä¾›ï¼‰
uv pip install -e ".[web]"

# â‘£ è¤‡åˆ: ç”»åƒç”Ÿæˆ + HTTP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°
uv pip install -e ".[visualization,streaming]"

# â‘¤ é–‹ç™ºç’°å¢ƒ + ç”»åƒç”Ÿæˆæ©Ÿèƒ½
uv pip install -e ".[dev,visualization]"

# â‘¥ é–‹ç™ºç’°å¢ƒ + ã™ã¹ã¦ã®æ©Ÿèƒ½ï¼ˆæ¨å¥¨ for developmentï¼‰
uv pip install -e ".[dev,full]"

# â‘¦ æœ¬ç•ªç’°å¢ƒ: Web API + ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° + ãƒ­ã‚°
uv pip install -e ".[web,streaming,logging]"

# â‘§ å®Œå…¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã™ã¹ã¦ã®æ©Ÿèƒ½ï¼‰
uv pip install -e ".[full]"
```

### å„ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã®è©³ç´°

#### ğŸ¨ `visualization` - ç”»åƒç”Ÿæˆæ©Ÿèƒ½

æ”¯å‡ºãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ã‚°ãƒ©ãƒ•ã¨ã—ã¦ PNG/SVG å½¢å¼ã§ç”Ÿæˆã—ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `matplotlib >= 3.8.0` - ã‚°ãƒ©ãƒ•æç”»
- `plotly >= 5.17.0` - ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ£ãƒ¼ãƒˆ
- `pillow >= 10.0.0` - ç”»åƒå‡¦ç†

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[visualization]"
python -c "from src.household_mcp.visualization import ChartGenerator; print('OK')"
```

**å¿…è¦ãªè¨­å®š:**

- æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆé…ç½®ï¼ˆ`fonts/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« Noto Sans CJK ã‚’é…ç½®ï¼‰
- è©³ç´°ã¯ä¸‹è¨˜ã€Œæ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®šã€ã‚’å‚ç…§

---

#### ğŸŒ `streaming` - HTTP ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ

ç”»åƒã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç›´æ¥é…ä¿¡å¯èƒ½ãª HTTP ã‚µãƒ¼ãƒãƒ¼æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `fastapi >= 0.100.0` - Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
- `uvicorn[standard] >= 0.23.0` - ASGI ã‚µãƒ¼ãƒãƒ¼
- `cachetools >= 5.3.0` - ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æ©Ÿæ§‹

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[streaming]"
python -m src.server --transport http --port 8080
```

**ä¾å­˜é–¢ä¿‚:**

- `visualization` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚°ãƒ©ãƒ•ã‚’ HTTP çµŒç”±ã§é…ä¿¡å¯èƒ½

---

#### ğŸ”Œ `web` - REST API

å®Œå…¨ãª REST API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…¬é–‹ã—ã€HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `fastapi >= 0.100.0`
- `uvicorn[standard] >= 0.23.0`
- `pydantic >= 2.11, < 3` - ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼
- `python-multipart >= 0.0.6` - ãƒãƒ«ãƒãƒ‘ãƒ¼ãƒˆå½¢å¼å¯¾å¿œ

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[web]"
uv run uvicorn src.household_mcp.server:app --port 8000
```

---

#### ğŸ’¾ `db` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€£æº

SQLAlchemy ORM ã‚’ç”¨ã„ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ°¸ç¶šåŒ–ï¼ˆå°†æ¥ã®æ‹¡å¼µå‘ã‘ï¼‰

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `sqlalchemy >= 2.0.23` - ORM
- `alembic >= 1.12.1` - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[db]"
# SQLite/PostgreSQL ã¸ã®æ°¸ç¶šåŒ–æ©Ÿèƒ½ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
```

---

#### ğŸ” `auth` - èªè¨¼æ©Ÿèƒ½

JWTãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼ã‚’å®Ÿè£…ã—ã€API ã®ä¿è­·ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ã«å¯¾å¿œã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `passlib[bcrypt] >= 1.7.4` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ³ã‚°
- `python-jose[cryptography] >= 3.3.0` - JWT ç½²å

**ä½¿ç”¨ä¾‹:**

```bash
uv pip install -e ".[auth]"
# API èªè¨¼æ©Ÿèƒ½ï¼ˆå°†æ¥å®Ÿè£…ï¼‰
```

---

#### âš¡ `io` - éåŒæœŸ I/O

éåŒæœŸãƒ•ã‚¡ã‚¤ãƒ« I/Oãƒ»HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ©Ÿèƒ½ã‚’æä¾›ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `aiofiles >= 23.2.1` - éåŒæœŸãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œ
- `httpx >= 0.25.2` - éåŒæœŸ HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ

---

#### ğŸ“Š `logging` - æ§‹é€ åŒ–ãƒ­ã‚°

JSON å½¢å¼ã®æ§‹é€ åŒ–ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã€ãƒ­ã‚°è§£æãƒ»ç›£è¦–ã‚’å®¹æ˜“ã«ã—ã¾ã™ã€‚

**å«ã¾ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**

- `structlog >= 23.2.0` - ãƒ­ã‚°æ§‹é€ åŒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ä½¿ç”¨ä¾‹:**

```bash
# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv pip install -e ".[logging]"

# Pythonã‚³ãƒ¼ãƒ‰ã§ä½¿ç”¨
from household_mcp.logging_config import setup_logging, get_logger

# æ¨™æº–ãƒ­ã‚°è¨­å®š
setup_logging(level="INFO")

# æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ï¼‰
setup_logging(level="DEBUG", use_structlog=True, json_format=False)

# æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆJSONå‡ºåŠ› - æœ¬ç•ªç’°å¢ƒæ¨å¥¨ï¼‰
setup_logging(level="INFO", use_structlog=True, json_format=True)

# ãƒ­ã‚¬ãƒ¼ã‚’å–å¾—
logger = get_logger(__name__)
logger.info("Application started", version="0.1.0", user_count=42)
```

---

#### ğŸ `full` - å®Œå…¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã™ã¹ã¦ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚é–‹ç™ºç’°å¢ƒã‚„è©¦é¨“ç”¨ã«æ¨å¥¨ã€‚

```bash
uv pip install -e ".[full]"
uv pip install -e ".[full,dev]"  # é–‹ç™ºç’°å¢ƒ + å…¨æ©Ÿèƒ½
```

### Poetry ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆ

```bash
poetry install --with dev
# ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½: poetry install -E visualization
```

### pre-commit ãƒ•ãƒƒã‚¯ã®æœ‰åŠ¹åŒ–

```bash
pre-commit install
```

## ä½¿ç”¨æ–¹æ³•

### MCP / HTTP ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ï¼ˆMonorepo æ§‹æˆï¼‰

```bash
# 1) ä¾å­˜ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆbackend/ ã§ï¼‰
uv install --dev

# 2) ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¾å­˜ï¼ˆAPI/å¯è¦–åŒ–/DB ãŒå¿…è¦ãªå ´åˆï¼‰
uv pip install -e ".[web,streaming,visualization,db]"

# 3) API ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆbackend/ ã«ã¦ï¼‰
uv run python -m uvicorn household_mcp.web.http_server:create_http_app \
  --factory --reload --host 0.0.0.0 --port 8000

# ä»£æ›¿: VS Code ã‚¿ã‚¹ã‚¯
# - Start HTTP API Serverï¼ˆbackend/ï¼‰
# - Start Full Webapp Stackï¼ˆAPI 8000 + Web 8080 ã‚’ä¸¦åˆ—èµ·å‹•ï¼‰
```

### ğŸŒ Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½¿ç”¨

HTTPã‚µãƒ¼ãƒã¨é€šä¿¡ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«å®¶è¨ˆç°¿ã‚’æ“ä½œã§ãã‚‹Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚

#### èµ·å‹•æ–¹æ³•

1. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•ï¼ˆbackend/ï¼‰**

```bash
# API ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ8000ï¼‰
uv run python -m uvicorn household_mcp.web.http_server:create_http_app \
  --factory --reload --host 0.0.0.0 --port 8000
```

æ¬¡ã« Web ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã¾ã™ï¼š

```bash
# frontend ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã—ã¦HTTPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ8080ï¼‰
cd frontend
python3 -m http.server 8080
```

ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ï¼š

```text
http://localhost:8080
```

#### Webã‚¢ãƒ—ãƒªã®æ©Ÿèƒ½

- âœ… **å¹´æœˆé¸æŠ** - ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‹ã‚‰æœŸé–“ã‚’é¸æŠ
- âœ… **ã‚°ãƒ©ãƒ•è¡¨ç¤º** - å††ã‚°ãƒ©ãƒ•ã€æ£’ã‚°ãƒ©ãƒ•ã€æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ã§ãƒ‡ãƒ¼ã‚¿ã‚’å¯è¦–åŒ–
- âœ… **çµ±è¨ˆè¡¨ç¤º** - ç·æ”¯å‡ºã€å–å¼•ä»¶æ•°ã€å¹³å‡æ”¯å‡ºã€æœ€å¤§æ”¯å‡º
- âœ… **ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«** - å–å¼•ã®è©³ç´°ã‚’ãƒ†ãƒ¼ãƒ–ãƒ«ã§è¡¨ç¤º
- âœ… **æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿** - æ—¥ä»˜ã‚„å†…å®¹ã§æ¤œç´¢ã€ã‚«ãƒ†ã‚´ãƒªã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- âœ… **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³** - PCãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³å¯¾å¿œ

è©³ç´°ã¯ [`frontend/README.md`](frontend/README.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ç”»åƒç”Ÿæˆæ©Ÿèƒ½

MCPãƒ„ãƒ¼ãƒ«ã‹ã‚‰ç›´æ¥ã‚°ãƒ©ãƒ•ç”»åƒã‚’ç”Ÿæˆã—ã¦ã€AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«è¦–è¦šçš„ãªæ´å¯Ÿã‚’æä¾›ã§ãã¾ã™ã€‚

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€`visualization` ã¨ `streaming` extras ãŒå¿…è¦ã§ã™ï¼š

```bash
# ç”»åƒç”Ÿæˆã«å¿…è¦ãªä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv pip install -e ".[visualization,streaming]"

# ã¾ãŸã¯ã€ã™ã¹ã¦ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’ä¸€æ‹¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv pip install -e ".[full]"
```

#### æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®š

æ—¥æœ¬èªãƒ©ãƒ™ãƒ«ä»˜ãã‚°ãƒ©ãƒ•ã‚’ç”Ÿæˆã™ã‚‹ã«ã¯ã€CJKãƒ•ã‚©ãƒ³ãƒˆãŒå¿…è¦ã§ã™ï¼š

```bash
# fonts/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆï¼ˆæ—¢ã«å­˜åœ¨ã™ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ï¼‰
mkdir -p fonts

# Noto Sans CJK ãƒ•ã‚©ãƒ³ãƒˆã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆUbuntu/Debianï¼‰
# ã‚·ã‚¹ãƒ†ãƒ ã«æ—¢ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯è‡ªå‹•æ¤œå‡ºã•ã‚Œã¾ã™
sudo apt-get install fonts-noto-cjk

# ã¾ãŸã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã«é…ç½®
# fonts/NotoSansCJKjp-Regular.otf ã‚’é…ç½®
```

ChartGeneratorã¯ä»¥ä¸‹ã®é †åºã§ãƒ•ã‚©ãƒ³ãƒˆã‚’è‡ªå‹•æ¤œå‡ºã—ã¾ã™ï¼š

1. `fonts/NotoSansCJKjp-Regular.otf`ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
2. ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`/usr/share/fonts/`ãªã©ï¼‰

#### èµ·å‹•æ–¹æ³•

##### 1. ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆæ¨å¥¨ï¼‰

HTTPã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¦ã€ç”Ÿæˆã—ãŸç”»åƒã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰å–å¾—å¯èƒ½ã«ã—ã¾ã™ï¼š

```bash
# HTTPã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ï¼ˆãƒãƒ¼ãƒˆ8000ï¼‰
uv run python -m uvicorn household_mcp.web.http_server:create_http_app --factory --reload --host 0.0.0.0 --port 8000

# MCP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰æ¥ç¶šï¼ˆstdioï¼‰
# AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¯MCPçµŒç”±ã§ãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã—ã€HTTPã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ç”»åƒã‚’å–å¾—
```

##### 2. stdioãƒ¢ãƒ¼ãƒ‰ï¼ˆç”»åƒç”Ÿæˆãªã—ï¼‰

ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®MCPé€šä¿¡ã®ã¿ï¼š

```bash
uv run mcp install src/household_mcp/server.py
```

#### ã‚µãƒãƒ¼ãƒˆã•ã‚Œã‚‹ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒ—

- **å††ã‚°ãƒ©ãƒ•ï¼ˆpieï¼‰**: ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡ºå‰²åˆ
- **æ£’ã‚°ãƒ©ãƒ•ï¼ˆbarï¼‰**: ã‚«ãƒ†ã‚´ãƒªåˆ¥æ¯”è¼ƒ
- **æŠ˜ã‚Œç·šã‚°ãƒ©ãƒ•ï¼ˆlineï¼‰**: æ™‚ç³»åˆ—ãƒˆãƒ¬ãƒ³ãƒ‰
- **é¢ã‚°ãƒ©ãƒ•ï¼ˆareaï¼‰**: ç´¯ç©ãƒˆãƒ¬ãƒ³ãƒ‰

#### MCPãƒ„ãƒ¼ãƒ«ã‹ã‚‰ã®ä½¿ç”¨ä¾‹

Enhanced MCPãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã€ç”»åƒå½¢å¼ã§ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—ï¼š

```python
# æœˆæ¬¡ã‚µãƒãƒªãƒ¼ã‚’ç”»åƒã§å–å¾—
{
  "tool": "enhanced_monthly_summary",
  "arguments": {
    "year": 2025,
    "month": 10,
    "output_format": "image",  # "text" ã¾ãŸã¯ "image"
    "graph_type": "pie",       # "pie", "bar", "line", "area"
    "image_size": "800x600",   # WxHå½¢å¼
    "image_format": "png"      # "png" ã¾ãŸã¯ "svg"
  }
}

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹
{
  "success": true,
  "type": "image",
  "url": "http://localhost:8000/api/charts/abc123def456",
  "chart_id": "abc123def456",
  "size_bytes": 55942
}

# ã‚«ãƒ†ã‚´ãƒªãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ç”»åƒã§å–å¾—
{
  "tool": "enhanced_category_trend",
  "arguments": {
    "category": "é£Ÿè²»",
    "start_month": "2024-01",
    "end_month": "2024-06",
    "output_format": "image"
  }
}
```

**HTTP ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆçµŒç”±ã§ã®ã‚¢ã‚¯ã‚»ã‚¹**:

HTTPã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã—ãŸå ´åˆã€ä»¥ä¸‹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼š

```bash
# ç”»åƒå–å¾—ï¼ˆã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é…ä¿¡ï¼‰
GET http://localhost:8000/api/charts/{chart_id}

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥æƒ…å ±å–å¾—
GET http://localhost:8000/api/charts/{chart_id}/info

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±è¨ˆ
GET http://localhost:8000/api/cache/stats

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
DELETE http://localhost:8000/api/cache

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
GET http://localhost:8000/health
```

è©³ç´°ã¯ `docs/api.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†ææ©Ÿèƒ½ã®è©³ç´°

#### 1. ã‚«ãƒ†ã‚´ãƒªãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆ`get_category_trend`ï¼‰

ç‰¹å®šã‚«ãƒ†ã‚´ãƒªã®æ™‚ç³»åˆ—æ¨ç§»ã‚’åˆ†æã—ã€ä»¥ä¸‹ã®æŒ‡æ¨™ã‚’æä¾›ã—ã¾ã™ï¼š

**æä¾›ã•ã‚Œã‚‹æŒ‡æ¨™:**

- æœˆæ¬¡æ”¯å‡ºé‡‘é¡
- å‰æœˆæ¯”ï¼ˆMoM: Month over Monthï¼‰
- å‰å¹´åŒæœˆæ¯”ï¼ˆYoY: Year over Yearï¼‰
- 12ãƒ¶æœˆç§»å‹•å¹³å‡

**ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›ä¾‹:**

```json
{
  "tool": "get_category_trend",
  "arguments": {
    "category": "é£Ÿè²»",
    "start_month": "2024-01",
    "end_month": "2024-06"
  }
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "category": "é£Ÿè²»",
  "start_month": "2024-01",
  "end_month": "2024-06",
  "text": "é£Ÿè²»ã® 2024å¹´01æœˆã€œ2024å¹´06æœˆ ã®æ¨ç§»ã§ã™ã€‚...",
  "metrics": [
    {
      "month": "2024-01",
      "amount": -110942,
      "month_over_month": null,
      "year_over_year": -0.05,
      "moving_avg_12m": -108500
    },
    {
      "month": "2024-02",
      "amount": -123750,
      "month_over_month": 0.115,
      "year_over_year": 0.08,
      "moving_avg_12m": -109200
    }
    // ... ä»¥ä¸‹ç¶šã
  ]
}
```

**ç”»åƒå‡ºåŠ›ä¾‹:**

```json
{
  "tool": "get_category_trend",
  "arguments": {
    "category": "é£Ÿè²»",
    "start_month": "2024-01",
    "end_month": "2024-06",
    "output_format": "image",
    "graph_type": "bar",
    "image_size": "1000x600"
  }
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "success": true,
  "type": "image",
  "url": "http://localhost:8000/api/charts/abc123...",
  "cache_key": "abc123...",
  "media_type": "image/png",
  "alt_text": "é£Ÿè²»ã®ãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆbarï¼‰",
  "metadata": {
    "category": "é£Ÿè²»",
    "start_month": "2024-01",
    "end_month": "2024-06",
    "graph_type": "bar",
    "image_size": "1000x600"
  }
}
```

#### 2. ã‚«ãƒ†ã‚´ãƒªåˆ†æï¼ˆ`category_analysis`ï¼‰

æŒ‡å®šæœŸé–“ã«ãŠã‘ã‚‹å…¨ã‚«ãƒ†ã‚´ãƒªã®æ”¯å‡ºçŠ¶æ³ã‚’ä¸€æ‹¬åˆ†æã—ã¾ã™ã€‚

**æä¾›ã•ã‚Œã‚‹æƒ…å ±:**

- æœŸé–“å†…ã®ç·æ”¯å‡ºï¼ˆã‚«ãƒ†ã‚´ãƒªåˆ¥ï¼‰
- å‰æœˆæ¯”ã®å¤‰åŒ–ç‡
- æœ€å¤§ãƒ»æœ€å°æ”¯å‡ºæœˆ
- ãƒˆãƒƒãƒ—Næ”¯å‡ºã‚«ãƒ†ã‚´ãƒª

**ä½¿ç”¨ä¾‹:**

```json
{
  "tool": "category_analysis",
  "arguments": {
    "start_month": "2024-01",
    "end_month": "2024-06",
    "top_n": 5
  }
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "period": "2024-01 ã€œ 2024-06",
  "total_expense": -850000,
  "categories": [
    {
      "name": "é£Ÿè²»",
      "total": -350000,
      "avg_monthly": -58333,
      "month_over_month": 0.05,
      "max_month": {"month": "2024-05", "amount": -65000},
      "min_month": {"month": "2024-02", "amount": -52000}
    },
    // ... ãƒˆãƒƒãƒ—Nä»¶
  ],
  "top_categories": ["é£Ÿè²»", "ä½å±…", "äº¤é€šãƒ»é€šä¿¡", "æ—¥ç”¨å“", "å¨¯æ¥½"]
}
```

#### 3. æœˆæ¬¡ã‚µãƒãƒªãƒ¼ç”»åƒç”Ÿæˆï¼ˆ`get_monthly_household`ï¼‰

ç‰¹å®šæœˆã®æ”¯å‡ºæ§‹æˆã‚’è¦–è¦šåŒ–ã—ã¾ã™ã€‚

**ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒ—:**

- `pie`: ã‚«ãƒ†ã‚´ãƒªåˆ¥æ”¯å‡ºå‰²åˆï¼ˆå††ã‚°ãƒ©ãƒ•ï¼‰
- `bar`: ã‚«ãƒ†ã‚´ãƒªåˆ¥é‡‘é¡æ¯”è¼ƒï¼ˆæ£’ã‚°ãƒ©ãƒ•ï¼‰

**ä½¿ç”¨ä¾‹:**

```json
{
  "tool": "get_monthly_household",
  "arguments": {
    "year": 2024,
    "month": 10,
    "output_format": "image",
    "graph_type": "pie",
    "image_size": "800x600"
  }
}

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "success": true,
  "type": "image",
  "url": "http://localhost:8000/api/charts/def456...",
  "cache_key": "def456...",
  "media_type": "image/png",
  "alt_text": "2024å¹´10æœˆã®æ”¯å‡ºæ§‹æˆï¼ˆpieï¼‰",
  "metadata": {
    "year": 2024,
    "month": 10,
    "graph_type": "pie",
    "image_size": "800x600"
  }
}
```

### åˆ©ç”¨å¯èƒ½ãª MCP ãƒªã‚½ãƒ¼ã‚¹ / ãƒ„ãƒ¼ãƒ«

#### ãƒªã‚½ãƒ¼ã‚¹ä¸€è¦§

| åç§°                            | ç¨®åˆ¥     | èª¬æ˜                                 |
| ------------------------------- | -------- | ------------------------------------ |
| `data://category_hierarchy`     | Resource | å¤§é …ç›®â†’ä¸­é …ç›®ã®ã‚«ãƒ†ã‚´ãƒªè¾æ›¸          |
| `data://available_months`       | Resource | CSV ã‹ã‚‰æ¤œå‡ºã—ãŸåˆ©ç”¨å¯èƒ½å¹´æœˆ         |
| `data://category_trend_summary` | Resource | ç›´è¿‘ 12 ã‹æœˆã®ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒˆãƒ¬ãƒ³ãƒ‰æƒ…å ± |

#### ãƒ„ãƒ¼ãƒ«ä¸€è¦§

| åç§°                       | èª¬æ˜                                                  | å‡ºåŠ›å½¢å¼        |
| -------------------------- | ----------------------------------------------------- | --------------- |
| `get_monthly_household`    | æŒ‡å®šå¹´æœˆã®æ”¯å‡ºæ˜ç´°ä¸€è¦§ã¨æœˆæ¬¡ã‚µãƒãƒªãƒ¼                  | ãƒ†ã‚­ã‚¹ãƒˆ        |
| `get_category_trend`       | ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æï¼ˆå‰æœˆæ¯”ãƒ»å‰å¹´æ¯”ãƒ»ç§»å‹•å¹³å‡ï¼‰    | ãƒ†ã‚­ã‚¹ãƒˆ        |
| `category_analysis`        | ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®æœŸé–“åˆ†æï¼ˆå‰æœˆæ¯”ãƒ»æœ€å¤§æœ€å°ãƒ»ãƒˆãƒƒãƒ—Næ”¯å‡ºï¼‰ | ãƒ†ã‚­ã‚¹ãƒˆ        |
| `find_categories`          | åˆ©ç”¨å¯èƒ½ãªã‚«ãƒ†ã‚´ãƒªä¸€è¦§ã‚’å–å¾—                          | ãƒ†ã‚­ã‚¹ãƒˆ        |
| `monthly_summary`          | æœˆæ¬¡ã‚µãƒãƒªï¼ˆåå…¥ãƒ»æ”¯å‡ºãƒ»ã‚«ãƒ†ã‚´ãƒªåˆ¥é›†è¨ˆï¼‰              | ãƒ†ã‚­ã‚¹ãƒˆ        |
| `enhanced_monthly_summary` | æœˆæ¬¡ã‚µãƒãƒªãƒ¼ï¼ˆç”»åƒå¯¾å¿œï¼‰                              | ãƒ†ã‚­ã‚¹ãƒˆ / ç”»åƒ |
| `enhanced_category_trend`  | ã‚«ãƒ†ã‚´ãƒªãƒˆãƒ¬ãƒ³ãƒ‰ï¼ˆç”»åƒå¯¾å¿œï¼‰                          | ãƒ†ã‚­ã‚¹ãƒˆ / ç”»åƒ |

### HTTP API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã§èµ·å‹•ã—ãŸå ´åˆã€ä»¥ä¸‹ã®HTTP APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼š

#### ãƒãƒ£ãƒ¼ãƒˆç”»åƒé…ä¿¡

```text
GET /api/charts/{chart_id}
```

ç”Ÿæˆã•ã‚ŒãŸãƒãƒ£ãƒ¼ãƒˆç”»åƒã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é…ä¿¡ã—ã¾ã™ã€‚

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**

- `chart_id` (path): ãƒãƒ£ãƒ¼ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ï¼ˆMCPãƒ„ãƒ¼ãƒ«ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰å–å¾—ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

- `Content-Type: image/png`
- StreamingResponseï¼ˆãƒãƒ£ãƒ³ã‚¯é…ä¿¡ã€8KBå˜ä½ï¼‰

**ä½¿ç”¨ä¾‹:**

```bash
# MCPãƒ„ãƒ¼ãƒ«ã§ç”»åƒç”Ÿæˆå¾Œã€è¿”ã•ã‚ŒãŸURLã‚’ä½¿ç”¨
curl http://localhost:8000/api/charts/abc123def456 -o chart.png
```

#### ãƒãƒ£ãƒ¼ãƒˆæƒ…å ±å–å¾—

```text
GET /api/charts/{chart_id}/info
```

ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒãƒ£ãƒ¼ãƒˆã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "chart_id": "abc123def456",
  "size_bytes": 55942,
  "media_type": "image/png"
}
```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±è¨ˆ

```text
GET /api/cache/stats
```

ãƒãƒ£ãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®çµ±è¨ˆæƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "current_size": 12,
  "max_size": 50,
  "ttl": 3600,
  "hit_rate": 0.75
}
```

#### ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢

```text
DELETE /api/cache
```

ã™ã¹ã¦ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸãƒãƒ£ãƒ¼ãƒˆç”»åƒã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "status": "success",
  "message": "Cache cleared"
}
```

#### ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

```text
GET /health
```

ã‚µãƒ¼ãƒãƒ¼ã®ç¨¼åƒçŠ¶æ³ã‚’ç¢ºèªã—ã¾ã™ã€‚

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹:**

```json
{
  "status": "healthy",
  "cache_size": 12
}
```

è©³ç´°ã¯ [`docs/api.md`](docs/api.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ç”»åƒç”Ÿæˆã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°

ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã¯ä»¥ä¸‹ã®æœ€é©åŒ–ãŒæ–½ã•ã‚Œã¦ã„ã¾ã™ï¼š

**ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™:**

- åˆå›ç”Ÿæˆ: 3ç§’ä»¥å†…
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ: 0.5ç§’ä»¥å†…
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡: 50MBä»¥å†…ï¼ˆä¸¦è¡Œç”Ÿæˆæ™‚ï¼‰

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹:**

ç”Ÿæˆã•ã‚ŒãŸç”»åƒã¯è‡ªå‹•çš„ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã€åŒä¸€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã®å†ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«å³åº§ã«è¿”ã•ã‚Œã¾ã™ã€‚

```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥çµ±è¨ˆã®ç¢ºèª
curl http://localhost:8000/api/cache/stats

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
curl -X DELETE http://localhost:8000/api/cache
```

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ã®æ§‹æˆè¦ç´ :**

- ç”»åƒã‚¿ã‚¤ãƒ—ï¼ˆmonthly, trendï¼‰
- å¹´æœˆ / ã‚«ãƒ†ã‚´ãƒª
- ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒ—ï¼ˆpie, bar, line, areaï¼‰
- ç”»åƒã‚µã‚¤ã‚º
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆpng, svgï¼‰

### ãƒ†ã‚¹ãƒˆãƒ»ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯

```bash
# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
uv run pytest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ããƒ†ã‚¹ãƒˆ
uv run pytest --cov=src/household_mcp --cov-report=html

# ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
uv run black .          # ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
uv run isort .          # ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ•´ç†
uv run flake8           # ãƒªãƒ³ãƒˆ
uv run mypy src/        # å‹ãƒã‚§ãƒƒã‚¯
uv run bandit -r src/   # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³

# ã™ã¹ã¦ã®ãƒã‚§ãƒƒã‚¯ã‚’ä¸€æ‹¬å®Ÿè¡Œ
uv run task all-checks  # â€» tasks.json ã«å®šç¾©
```

### CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯GitHub Actionsã§åŒ…æ‹¬çš„ãªCIãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ï¼š

**ãƒ†ã‚¹ãƒˆãƒãƒˆãƒªã‚¯ã‚¹:**

- Python 3.11, 3.12, 3.13, 3.14 ã§ã®ä¸¦åˆ—ãƒ†ã‚¹ãƒˆ
- pre-commit ãƒ•ãƒƒã‚¯æ¤œè¨¼ï¼ˆmarkdownlint, black, flake8, mypyï¼‰
- ã‚«ãƒãƒ¬ãƒƒã‚¸åé›†ï¼ˆ80%é–¾å€¤ï¼‰ã¨Codecové€£æº

**Lintã‚¸ãƒ§ãƒ–:**

- black, isort, flake8, mypy, bandit ã«ã‚ˆã‚‹é™çš„è§£æ
- Python 3.12ç’°å¢ƒã§ã®å®Ÿè¡Œ

**ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ä¾å­˜ãƒ†ã‚¹ãƒˆ:**

- 7ã¤ã®extrasã‚°ãƒ«ãƒ¼ãƒ—å€‹åˆ¥æ¤œè¨¼ï¼ˆvisualization, streaming, web, db, auth, io, loggingï¼‰
- ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ†ã‚¹ãƒˆï¼ˆ`-m "not slow" --maxfail=1`ï¼‰

**å®Œå…¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ:**

- `[full]` extra ã§ã®ã™ã¹ã¦ã®ä¾å­˜é–¢ä¿‚åŒæ™‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- å®Œå…¨ãªãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè¡Œ

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒˆãƒªã‚¬ãƒ¼:**

- Push to `main`
- Pull Request to `main`
- æ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼ï¼ˆ`workflow_dispatch`ï¼‰

è©³ç´°ã¯ [`.github/workflows/ci.yml`](.github/workflows/ci.yml) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®äº‹å‰æ¤œè¨¼:**

```bash
# pre-commitãƒ•ãƒƒã‚¯ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
uv run pre-commit install

# ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦pre-commitã‚’å®Ÿè¡Œ
uv run pre-commit run --all-files
```

### å®Ÿç”¨çš„ãªä½¿ç”¨ä¾‹

#### ã‚±ãƒ¼ã‚¹1: æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

```python
# å…ˆæœˆã®æ”¯å‡ºæ§‹æˆã‚’å††ã‚°ãƒ©ãƒ•ã§ç¢ºèª
from household_mcp.tools.enhanced_tools import enhanced_monthly_summary

result = enhanced_monthly_summary(
    year=2024,
    month=9,
    output_format="image",
    graph_type="pie",
    image_size="800x600"
)

print(f"ç”»åƒURL: {result['url']}")
print(f"ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼: {result['cache_key']}")
```

#### ã‚±ãƒ¼ã‚¹2: ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒˆãƒ¬ãƒ³ãƒ‰åˆ†æ

```python
# é£Ÿè²»ã®åŠå¹´ãƒˆãƒ¬ãƒ³ãƒ‰ã‚’æ£’ã‚°ãƒ©ãƒ•ã§å¯è¦–åŒ–
from household_mcp.tools.enhanced_tools import enhanced_category_trend

result = enhanced_category_trend(
    category="é£Ÿè²»",
    start_month="2024-04",
    end_month="2024-09",
    output_format="image",
    graph_type="bar",
    image_size="1000x600"
)

# ç”»åƒã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª
# ãƒ–ãƒ©ã‚¦ã‚¶ã§ result['url'] ã«ã‚¢ã‚¯ã‚»ã‚¹
```

#### ã‚±ãƒ¼ã‚¹3: å…¨ã‚«ãƒ†ã‚´ãƒªåˆ†æ

```python
# ç›´è¿‘3ãƒ¶æœˆã®å…¨ã‚«ãƒ†ã‚´ãƒªæ”¯å‡ºçŠ¶æ³ã‚’åˆ†æ
from household_mcp.tools.trend_tool import category_analysis

result = category_analysis(
    start_month="2024-07",
    end_month="2024-09",
    top_n=10
)

print(f"æœŸé–“ç·æ”¯å‡º: {result['total_expense']}å††")
for cat in result['top_categories']:
    print(f"  - {cat['name']}: {cat['total']}å††")
```

### ãƒ†ã‚¹ãƒˆ

```bash
uv run pytest
```

ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ 80% ã‚’æº€ãŸã™ã¨æˆåŠŸã§ã™ã€‚

## æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆè¨­å®š

ã‚°ãƒ©ãƒ•ç”Ÿæˆæ©Ÿèƒ½ã§æ—¥æœ¬èªï¼ˆæ¼¢å­—ãƒ»ã‚«ãƒŠï¼‰ã‚’æ­£ã—ãæç”»ã™ã‚‹ã«ã¯ã€æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚

### ãƒ•ã‚©ãƒ³ãƒˆé…ç½®ï¼ˆæ¨å¥¨ï¼‰

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `fonts/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« Noto Sans CJK ãƒ•ã‚©ãƒ³ãƒˆã‚’é…ç½®ã—ã¾ã™ï¼š

```bash
# Debian/Ubuntu ã®å ´åˆ
sudo apt-get install fonts-noto-cjk
cp /usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc fonts/

# ã¾ãŸã¯ã€ç›´æ¥ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
wget https://github.com/googlefonts/noto-cjk/raw/main/Sans/OTF/Japanese/NotoSansCJKjp-Regular.otf -O fonts/NotoSansCJKjp-Regular.otf
```

è©³ç´°ãªæ‰‹é †ã¯ `fonts/README.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

### ãƒ•ã‚©ãƒ³ãƒˆæ¤œå‡ºã®å„ªå…ˆé †ä½

`ChartGenerator` ã¯ä»¥ä¸‹ã®é †åºã§ãƒ•ã‚©ãƒ³ãƒˆã‚’æ¤œå‡ºã—ã¾ã™ï¼š

1. **ãƒ­ãƒ¼ã‚«ãƒ« fonts/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã® `fonts/` é…ä¸‹
2. **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å›ºæœ‰ãƒ‘ã‚¹**:
   - Linux: `/usr/share/fonts/opentype/noto/`, `/usr/share/fonts/truetype/noto/`
   - macOS: `/System/Library/Fonts/`
   - Windows: `C:/Windows/Fonts/`
3. **matplotlib font_manager**: ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸå…¨ãƒ•ã‚©ãƒ³ãƒˆã‹ã‚‰æ¤œç´¢

### ãƒ•ã‚©ãƒ³ãƒˆæœªè¨­å®šæ™‚ã®å‹•ä½œ

ãƒ•ã‚©ãƒ³ãƒˆãŒæ¤œå‡ºã§ããªã„å ´åˆã§ã‚‚ã‚°ãƒ©ãƒ•ç”Ÿæˆã¯å¯èƒ½ã§ã™ãŒã€æ—¥æœ¬èªãŒæ–‡å­—åŒ–ã‘ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ç”»åƒç”Ÿæˆæ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€å¿…ãšæ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚

### ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå‚è€ƒï¼‰

```bash
# Debian/Ubuntu
sudo apt-get update && sudo apt-get install -y fonts-noto-cjk

# Arch Linux
sudo pacman -Sy --noconfirm noto-fonts-cjk

# Alpine Linux
sudo apk add --no-cache font-noto-cjk

# macOS (Homebrew)
brew install font-noto-sans-cjk-jp

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ãƒ•ã‚©ãƒ³ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ›´æ–°
fc-cache -fv
```

## ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [åˆ©ç”¨ã‚¬ã‚¤ãƒ‰](docs/usage.md) - è©³ç´°ãªä½¿ç”¨æ–¹æ³•ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¬æ˜
- [ã‚µãƒ³ãƒ—ãƒ«ä¼šè©±ä¾‹](docs/examples.md) - LLMã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ã®å®Ÿè·µçš„ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆä¾‹
- [FAQ](docs/FAQ.md) - ã‚ˆãã‚ã‚‹è³ªå•ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- [API ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](docs/api.md) - HTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä»•æ§˜

## é–‹ç™º

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ [Kiro's Spec-Driven Development](https://github.com/kiro-dev) ã«å¾“ã£ã¦é–‹ç™ºã•ã‚Œã¦ã„ã¾ã™ï¼š

- [`requirements.md`](requirements.md) - è¦ä»¶å®šç¾©
- [`design.md`](design.md) - æŠ€è¡“è¨­è¨ˆ
- [`tasks.md`](tasks.md) - å®Ÿè£…ã‚¿ã‚¹ã‚¯

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License
