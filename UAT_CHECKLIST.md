# UAT（User Acceptance Testing）チェックリスト

- **バージョン**: 1.0.0
- **更新日**: 2025-10-30
- **対象システム**: Household Budget Analysis MCP Server
- **参照**: requirements.md v1.1, design.md v0.5.0

---

## 検収基準

### 前提条件

- [ ] Python 3.12以上がインストールされている
- [ ] uv または pip がインストールされている
- [ ] data/ ディレクトリにサンプルCSVファイルが配置されている
- [ ] 日本語フォント（NotoSansCJKjp-Regular.otf）が fonts/ に配置されている

---

## 1. インストールと環境設定（NFR-001, NFR-003）

### 1.1 基本インストール

- [ ] **TC-001**: `uv pip install -e .` でエラーなくインストールできる
- [ ] **TC-002**: `python -c "import household_mcp; print('OK')"` で正常にインポートできる
- [ ] **TC-003**: `python -m pytest tests/unit/ -v` で全単体テストが合格する

### 1.2 オプション機能インストール

- [ ] **TC-004**: `uv pip install -e ".[visualization]"` で画像生成機能がインストールされる
- [ ] **TC-005**: `uv pip install -e ".[streaming]"` でHTTPストリーミング機能がインストールされる
- [ ] **TC-006**: `uv pip install -e ".[full]"` で全機能がインストールされる

---

## 2. データ読み込み機能（FR-001, FR-002）

### 2.1 CSV読み込み

- [ ] **TC-101**: 指定した年月のCSVファイルが正しく読み込まれる
- [ ] **TC-102**: 存在しない年月を指定した場合、適切なエラーメッセージが返される（日本語）
- [ ] **TC-103**: CSVファイルの列名が正しくマッピングされる（大項目、中項目、金額）
- [ ] **TC-104**: 計算対象フラグ（0/1）によるフィルタリングが正しく動作する

### 2.2 キャッシュ機能

- [ ] **TC-105**: 同一データの2回目読み込みでキャッシュが利用される
- [ ] **TC-106**: CSVファイル更新時にキャッシュが無効化される
- [ ] **TC-107**: `cache_stats()` でヒット/ミス統計が取得できる

---

## 3. トレンド分析機能（FR-003, FR-005）

### 3.1 カテゴリトレンド

- [ ] **TC-201**: `get_category_trend` で指定カテゴリの月次推移が取得できる
- [ ] **TC-202**: 前月比（MoM）が正しく計算される
- [ ] **TC-203**: 前年同月比（YoY）が正しく計算される
- [ ] **TC-204**: 12ヶ月移動平均が正しく計算される
- [ ] **TC-205**: カテゴリ未指定時に全カテゴリのサマリーが返される

### 3.2 期間指定

- [ ] **TC-206**: `start_month` と `end_month` で期間指定ができる
- [ ] **TC-207**: 不正な期間指定（start > end）でエラーメッセージが返される
- [ ] **TC-208**: 利用可能な期間外を指定した場合、適切なエラーが返される

---

## 4. カテゴリ分析機能（FR-003）

### 4.1 category_analysis ツール

- [ ] **TC-301**: 指定カテゴリの期間分析が正しく実行される
- [ ] **TC-302**: 合計支出、平均支出が正しく計算される
- [ ] **TC-303**: 最大月・最小月が正しく特定される
- [ ] **TC-304**: 月次内訳データが正しく返される
- [ ] **TC-305**: 日本語サマリーテキストが生成される

---

## 5. 画像生成機能（FR-015, FR-016, NFR-005）

### 5.1 グラフ生成

- [ ] **TC-401**: 月次サマリーの円グラフが生成される
- [ ] **TC-402**: カテゴリトレンドの棒グラフが生成される
- [ ] **TC-403**: カテゴリトレンドの折れ線グラフが生成される
- [ ] **TC-404**: 日本語ラベルが正しく表示される（文字化けなし）

### 5.2 画像フォーマット

- [ ] **TC-405**: PNG形式で画像が出力される
- [ ] **TC-406**: SVG形式で画像が出力される（image_format="svg"指定時）
- [ ] **TC-407**: 指定した画像サイズ（800x600, 1024x768等）で出力される

### 5.3 パフォーマンス（NFR-005, NFR-006）

- [ ] **TC-408**: 初回画像生成が3秒以内に完了する
- [ ] **TC-409**: キャッシュヒット時の画像取得が0.5秒以内に完了する
- [ ] **TC-410**: 画像生成時のメモリ使用量が50MB以内である
- [ ] **TC-411**: 5件の同時画像生成リクエストが正常に処理される

---

## 6. HTTP ストリーミング機能（FR-016）

### 6.1 HTTPサーバー起動

- [ ] **TC-501**: `python -m src.server --transport streamable-http` でHTTPサーバーが起動する
- [ ] **TC-502**: `curl http://localhost:8000/health` でヘルスチェックが成功する
- [ ] **TC-503**: `/api/charts/{chart_id}` で画像が取得できる

### 6.2 キャッシュ管理

- [ ] **TC-504**: `/api/cache/stats` でキャッシュ統計が取得できる
- [ ] **TC-505**: `DELETE /api/cache` でキャッシュがクリアされる
- [ ] **TC-506**: 同一パラメータでの2回目リクエストでキャッシュが利用される

---

## 7. MCP リソース・ツール（FR-011, FR-014）

### 7.1 MCPリソース

- [ ] **TC-601**: `data://category_hierarchy` でカテゴリ階層が取得できる
- [ ] **TC-602**: `data://available_months` で利用可能月リストが取得できる
- [ ] **TC-603**: `data://category_trend_summary` で直近12ヶ月のサマリーが取得できる

### 7.2 MCPツール

- [ ] **TC-604**: `get_monthly_household` で月次データが取得できる（テキスト形式）
- [ ] **TC-605**: `get_monthly_household` で月次データが画像形式で取得できる（output_format="image"）
- [ ] **TC-606**: `get_category_trend` でトレンドデータが取得できる
- [ ] **TC-607**: `category_analysis` でカテゴリ分析が実行できる
- [ ] **TC-608**: `find_categories` でカテゴリ検索ができる
- [ ] **TC-609**: `monthly_summary` で月次サマリーが取得できる

### 7.3 エラーハンドリング（FR-014）

- [ ] **TC-610**: データ不足時のエラーメッセージが日本語で返される
- [ ] **TC-611**: カテゴリ未存在時のエラーメッセージが日本語で返される
- [ ] **TC-612**: 不正なパラメータ指定時のエラーメッセージが日本語で返される

---

## 8. プライバシーとセキュリティ（NFR-004, NFR-013）

### 8.1 ローカル処理

- [ ] **TC-701**: すべてのデータ処理がローカルで完結する（外部通信なし）
- [ ] **TC-702**: data/ ディレクトリ外のファイルにアクセスしない
- [ ] **TC-703**: 一時ファイルが適切に削除される

### 8.2 データ保護

- [ ] **TC-704**: CSVファイルが読み取り専用でアクセスされる
- [ ] **TC-705**: エラーログに機密情報（金額、カテゴリ詳細）が含まれない

---

## 9. パフォーマンス（NFR-002, NFR-011）

### 9.1 レスポンス時間

- [ ] **TC-801**: 月次データ取得が2秒以内に完了する（初回）
- [ ] **TC-802**: 月次データ取得が0.5秒以内に完了する（キャッシュヒット時）
- [ ] **TC-803**: トレンド分析が3秒以内に完了する

### 9.2 スケーラビリティ

- [ ] **TC-804**: 3年分（36ファイル）のCSVデータが正常に処理できる
- [ ] **TC-805**: 総レコード数10万件のデータが正常に処理できる
- [ ] **TC-806**: メモリ使用量が1GB以内に収まる（大量データ処理時）

---

## 10. ドキュメント（NFR-008）

### 10.1 技術ドキュメント

- [ ] **TC-901**: README.md が最新の機能を反映している
- [ ] **TC-902**: docs/usage.md に全ツールの使用方法が記載されている
- [ ] **TC-903**: docs/api.md にHTTPエンドポイント仕様が記載されている
- [ ] **TC-904**: docs/examples.md にサンプル会話例が記載されている
- [ ] **TC-905**: docs/FAQ.md によくある質問が記載されている

### 10.2 コード品質

- [ ] **TC-906**: 全単体テストが合格する（167/167 passing）
- [ ] **TC-907**: 全統合テストが合格する
- [ ] **TC-908**: black/isort/flake8/mypyがエラーなく実行できる
- [ ] **TC-909**: テストカバレッジが80%以上である

---

## 11. LLMクライアント統合

### 11.1 Claude Desktop

- [ ] **TC-1001**: Claude Desktop の設定ファイルに追加できる
- [ ] **TC-1002**: Claude Desktop から月次データ取得が実行できる
- [ ] **TC-1003**: Claude Desktop から画像生成が実行できる
- [ ] **TC-1004**: Claude Desktop でエラー時に日本語メッセージが表示される

### 11.2 その他MCPクライアント

- [ ] **TC-1005**: MCP標準プロトコルに準拠している
- [ ] **TC-1006**: stdio モードで正常に動作する
- [ ] **TC-1007**: HTTP モードで正常に動作する

---

## 検収合否判定基準

### 必須項目（Must Have）

以下の全項目が合格である必要があります：

- **環境設定**: TC-001, TC-002, TC-003
- **データ読み込み**: TC-101, TC-102, TC-103, TC-104
- **トレンド分析**: TC-201, TC-202, TC-206
- **画像生成基本**: TC-401, TC-404
- **MCPツール**: TC-604, TC-606, TC-607
- **エラーハンドリング**: TC-610, TC-611
- **プライバシー**: TC-701, TC-702
- **パフォーマンス**: TC-801, TC-803
- **ドキュメント**: TC-901, TC-906

### 推奨項目（Should Have）

以下の80%以上が合格であることが望ましい：

- すべての画像生成機能（TC-401〜TC-411）
- すべてのHTTPストリーミング機能（TC-501〜TC-506）
- すべてのMCPリソース・ツール（TC-601〜TC-612）
- パフォーマンス全項目（TC-801〜TC-806）

### オプション項目（Nice to Have）

- LLMクライアント統合（TC-1001〜TC-1007）

---

## 検収実施手順

1. **環境準備**（30分）
   - Python環境のセットアップ
   - 依存パッケージのインストール
   - サンプルデータの配置

2. **機能テスト**（2時間）
   - 必須項目のテスト実行
   - 推奨項目のテスト実行
   - 結果の記録

3. **パフォーマンステスト**（1時間）
   - レスポンス時間の計測
   - メモリ使用量の確認
   - 大量データでの動作確認

4. **統合テスト**（1時間）
   - LLMクライアントとの統合確認
   - エンドツーエンドシナリオの実行
   - エラーハンドリングの確認

5. **レポート作成**（30分）
   - テスト結果のまとめ
   - 不具合リストの作成
   - 検収合否の判定

---

## テスト実施記録

| テストID | 実施日 | 結果 | 備考 |
|---------|--------|------|------|
| TC-001  |        |      |      |
| TC-002  |        |      |      |
| ...     |        |      |      |

---

## 検収承認

- **テスト実施者**: ___________________
- **実施日**: ___________________
- **検収結果**: [ ] 合格 / [ ] 条件付き合格 / [ ] 不合格
- **承認者**: ___________________
- **承認日**: ___________________

---

## 参考資料

- [requirements.md](./requirements.md) - 機能要件定義
- [design.md](./design.md) - 技術設計書
- [README.md](./README.md) - インストール手順
- [docs/usage.md](./docs/usage.md) - 使用方法
- [docs/examples.md](./docs/examples.md) - サンプル会話例
- [docs/FAQ.md](./docs/FAQ.md) - よくある質問
