# サンプル会話例

このドキュメントでは、LLMクライアント（Claude、ChatGPT等）から Household MCP Server を使用する際の実践的なプロンプト例を紹介します。

## 基本的な会話パターン

### 例1: 月次支出の確認

**ユーザー**: 先月の支出を教えて

**LLMの処理**:

```json
{
  "tool": "get_monthly_household",
  "arguments": {
    "year": 2024,
    "month": 9
  }
}
```

**LLMの応答例**:
> 2024年9月の支出状況をお伝えします。
>
> **総支出**: 285,400円
>
> **支出が多かったカテゴリ TOP5**:
>
> 1. 食費: 95,200円
> 2. 住居: 65,000円
> 3. 交通・通信: 38,500円
> 4. 日用品: 28,700円
> 5. 光熱・水道: 22,000円
>
> 先月は食費が例年より少し高めです。外食が増えている可能性があります。

### 例2: カテゴリ別トレンドの確認

**ユーザー**: 食費の推移を半年分見せて

**LLMの処理**:

```json
{
  "tool": "get_category_trend",
  "arguments": {
    "category": "食費",
    "start_month": "2024-04",
    "end_month": "2024-09",
    "output_format": "image",
    "graph_type": "bar"
  }
}
```

**LLMの応答例**:
> 食費の半年間のトレンドをグラフで作成しました。
>
> ![食費のトレンド](http://localhost:8000/api/charts/abc123...)
>
> **傾向分析**:
>
> - 4月: 88,500円
> - 5月: 92,300円（+4.3%）
> - 6月: 89,800円（-2.7%）
> - 7月: 95,200円（+6.0%）
> - 8月: 93,100円（-2.2%）
> - 9月: 95,200円（+2.3%）
>
> 平均は約92,350円で、7月と9月にやや高くなる傾向が見られます。夏休みやイベントの影響かもしれません。

### 例3: 支出比較と分析

**ユーザー**: 今月は先月より支出減った?

**LLMの処理**:

```json
[
  {
    "tool": "get_monthly_household",
    "arguments": {"year": 2024, "month": 10}
  },
  {
    "tool": "get_monthly_household",
    "arguments": {"year": 2024, "month": 9}
  }
]
```

**LLMの応答例**:
> 10月と9月の支出を比較しました。
>
> - **9月**: 285,400円
> - **10月**: 267,800円
> - **差額**: -17,600円（-6.2%減少）
>
> **主な変化**:
>
> - 食費: 95,200円 → 88,300円（-7.2%）
> - 交通費: 38,500円 → 32,100円（-16.6%）
> - 娯楽費: 15,200円 → 12,500円（-17.8%）
>
> 全体的に支出が減少しています。特に交通費と娯楽費の削減が効果的でした。

## 画像生成を活用した会話

### 例4: 月次レポートの視覚化

**ユーザー**: 今月の支出構成を円グラフで見たい

**LLMの処理**:

```json
{
  "tool": "get_monthly_household",
  "arguments": {
    "year": 2024,
    "month": 10,
    "output_format": "image",
    "graph_type": "pie",
    "image_size": "800x600"
  }
}
```

**LLMの応答例**:
> 10月の支出構成を円グラフで表示します。
>
> ![10月の支出構成](http://localhost:8000/api/charts/def456...)
>
> **割合**:
>
> - 食費: 33%
> - 住居: 24%
> - 交通・通信: 14%
> - 光熱・水道: 8%
> - その他: 21%
>
> 食費が全体の3分の1を占めています。次いで住居関連が大きな割合です。

### 例5: トレンド比較

**ユーザー**: 食費と交際費の1年間の推移を比較したい

**LLMの処理**:

```json
[
  {
    "tool": "get_category_trend",
    "arguments": {
      "category": "食費",
      "start_month": "2023-11",
      "end_month": "2024-10",
      "output_format": "image",
      "graph_type": "line"
    }
  },
  {
    "tool": "get_category_trend",
    "arguments": {
      "category": "交際費",
      "start_month": "2023-11",
      "end_month": "2024-10",
      "output_format": "image",
      "graph_type": "line"
    }
  }
]
```

**LLMの応答例**:
> 食費と交際費の1年間の推移グラフを作成しました。
>
> **食費のトレンド**:
> ![食費](http://localhost:8000/api/charts/ghi789...)
>
> **交際費のトレンド**:
> ![交際費](http://localhost:8000/api/charts/jkl012...)
>
> **比較分析**:
>
> - 食費: 安定して月8〜10万円の範囲。12月と8月にやや増加。
> - 交際費: 変動が大きく、月2〜8万円。年末年始と夏季に増加傾向。
>
> 交際費は季節性が強く、イベント時期に支出が集中しています。

## 高度な分析パターン

### 例6: カテゴリ分析

**ユーザー**: 直近3ヶ月で一番支出が増えたカテゴリは?

**LLMの処理**:

```json
{
  "tool": "category_analysis",
  "arguments": {
    "start_month": "2024-08",
    "end_month": "2024-10",
    "top_n": 10
  }
}
```

**LLMの応答例**:
> 直近3ヶ月（8月〜10月）のカテゴリ別分析結果です。
>
> **支出増加率トップ3**:
>
> 1. 医療・保健: +35.2%（25,000円 → 33,800円）
> 2. 被服・履物: +18.5%（12,300円 → 14,600円）
> 3. 教育・教養: +12.1%（8,500円 → 9,500円）
>
> **支出減少率トップ3**:
>
> 1. 交通費: -16.6%（38,500円 → 32,100円）
> 2. 娯楽費: -15.8%（18,200円 → 15,300円）
> 3. 日用品: -8.3%（28,700円 → 26,300円）
>
> 医療・保健費の増加が目立ちます。定期検診や季節の風邪などの影響が考えられます。

### 例7: 予算管理

**ユーザー**: 今月の食費、予算10万円に収まってる?

**LLMの処理**:

```json
{
  "tool": "get_monthly_household",
  "arguments": {
    "year": 2024,
    "month": 10
  }
}
```

**LLMの応答例**:
> 10月の食費は88,300円でした。
>
> **予算との比較**:
>
> - 予算: 100,000円
> - 実績: 88,300円
> - 残額: 11,700円（予算達成率: 88.3%）
>
> ✅ 予算内に収まっています！余裕を持って達成できました。
>
> **参考**: 過去3ヶ月の平均は92,200円なので、今月は平均より抑えられています。

## LLMクライアント向けプロンプトのベストプラクティス

### 1. 具体的な期間を指定する

❌ 悪い例: 「最近の支出を教えて」
✅ 良い例: 「直近3ヶ月の支出を教えて」

### 2. 画像生成が必要か明示する

❌ 悪い例: 「食費の推移を見たい」
✅ 良い例: 「食費の推移をグラフで見たい」

### 3. 比較対象を明確にする

❌ 悪い例: 「支出が増えてる?」
✅ 良い例: 「今月の支出は先月と比べて増えてる?」

### 4. カテゴリ名を正確に指定する

❌ 悪い例: 「ごはん代」
✅ 良い例: 「食費」

利用可能なカテゴリは `find_categories` ツールで確認できます。

## トラブルシューティング

### よくあるエラーと対処法

#### エラー1: "Category not found"

**原因**: 指定したカテゴリ名が存在しない

**対処法**:

```json
{
  "tool": "find_categories",
  "arguments": {
    "pattern": "食"
  }
}
```

カテゴリ名を検索してから、正確な名称を使用してください。

#### エラー2: "No data available for the specified period"

**原因**: 指定した期間のデータが存在しない

**対処法**:

```json
{
  "tool": "data://available_months",
  "arguments": {}
}
```

リソースで利用可能な期間を確認してください。

#### エラー3: "Visualization dependencies not installed"

**原因**: 画像生成に必要なパッケージがインストールされていない

**対処法**:

```bash
uv pip install -e ".[visualization]"
```

または、`output_format: "text"` でテキスト形式のみを使用してください。

#### エラー4: "Font not found - Japanese text may not render correctly"

**原因**: 日本語フォントが配置されていない

**対処法**:

```bash
wget https://github.com/googlefonts/noto-cjk/raw/main/Sans/OTF/Japanese/NotoSansCJKjp-Regular.otf -O fonts/NotoSansCJKjp-Regular.otf
```

詳細は `README.md` の「日本語フォント設定」を参照してください。

## Webアプリケーションの使用

### 例13: ブラウザからのインタラクティブ分析

MCP経由のCLI操作に加え、Webブラウザから直感的に家計簿を分析できます。

**起動手順**:

1. バックエンドAPIサーバーを起動:

   ```bash
   uv run python -m uvicorn household_mcp.web.http_server:create_http_app --factory --reload --host 0.0.0.0 --port 8000
   ```

2. Webアプリを起動（別ターミナル）:

   ```bash
   cd webapp
   python3 -m http.server 8080
   ```

3. ブラウザでアクセス: `http://localhost:8080`

**Webアプリの主な機能**:

- **年月選択**: ドロップダウンから期間を選択
- **グラフ表示**: 円グラフ・棒グラフ・折れ線グラフでデータ可視化
- **統計サマリー**: 総支出、取引件数、平均支出、最大支出をカード表示
- **データテーブル**: 取引明細を表形式で表示
- **検索・フィルタ**: 日付・内容で検索、カテゴリでフィルタリング
- **レスポンシブデザイン**: PC・タブレット・スマートフォン対応

**ユースケース**:

- LLMに質問する前に、全体像を視覚的に把握したい
- 非エンジニアのユーザー（家族など）が簡単に確認したい
- 月次レポートをブラウザで素早く確認したい

詳細は [`webapp/README.md`](../webapp/README.md) を参照してください。

### 例14: MCP + Webアプリの併用

**シナリオ**: LLMで分析後、Webアプリで詳細確認

**ステップ1 - LLMで傾向分析**:

**ユーザー**: 最近3ヶ月で支出が増えているカテゴリを教えて

**LLM応答**:
> カテゴリ別の分析結果:
>
> **増加傾向のカテゴリ**:
>
> 1. 食費: +12.5%（8月 → 10月）
> 2. 娯楽費: +8.3%
> 3. 交際費: +5.7%
>
> 食費の増加が特に顕著です。外食や食材費の上昇が影響している可能性があります。

**ステップ2 - Webアプリで詳細確認**:

1. ブラウザで `http://localhost:8080` を開く
2. 10月を選択してグラフ表示
3. データテーブルで「食費」カテゴリをフィルタ
4. 個別の取引明細を確認し、具体的な支出項目を特定

**ステップ3 - LLMで次のアクション提案**:

**ユーザー**: 食費を減らす方法を提案して

**LLM応答**:
> Webアプリで確認した食費の内訳から、以下の改善案を提案します:
>
> 1. **外食費の見直し**: 週3回 → 週1-2回に減らす（月1.5万円削減見込み）
> 2. **食材のまとめ買い**: 週末にまとめ買いで無駄を削減
> 3. **お弁当の活用**: ランチ代を月5,000円削減
>
> 目標: 次月の食費を8万円台に抑える

## 次のステップ

- [API リファレンス](./api.md) - 全ツールの詳細仕様
- [利用ガイド](./usage.md) - 技術的な使用方法
- [FAQ](./FAQ.md) - よくある質問とトラブルシューティング
- [Webアプリガイド](../webapp/README.md) - ブラウザUI詳細
- [README.md](../README.md) - インストールとセットアップ
